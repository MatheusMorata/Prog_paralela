/* 
    Cálculo do produto escalar em paralelo, utilizando trecho crítico
*/

#include <stdlib.h>
#include <stdio.h>
#include <omp.h>
#include <sys/time.h>

void main(){
    double a[100000], b[100000];
    int n = 100000;
    int i;
    double soma_compartilhada = 0;
    struct timeval start, end;

    for(i = 0; i<n; i++){
        a[i] = i * 0.5;
        b[i] = i * 2;
    }


    // Captura o tempo de início
    gettimeofday(&start, NULL);
    #pragma omp parallel
    {
        double soma_local = 0;
        #pragma omp for nowait 
            for(i = 1; i<n; i++){
                soma_local += a[i] * b[i];
            }
        #pragma omp critical
        {
            soma_compartilhada += soma_local;
        }
    }
        
     // Captura o tempo de fim
    gettimeofday(&end, NULL);

    // Calcula a diferença em microsegundos
    long seconds = end.tv_sec - start.tv_sec;
    long microseconds = end.tv_usec - start.tv_usec;
    double elapsed = seconds + microseconds * 1e-6;

    printf("Soma = %.2f\n",soma_compartilhada);
    printf("Tempo de execução: %.8f segundos\n", elapsed);
}
